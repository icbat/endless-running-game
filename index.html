<html>

<head>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
</head>

<body>
    <div id="launches">
        <h2>App Launches</h2>
        <div class="metric"></div>
    </div>
    <div id="gamesStarted">
        <h2>Games Played</h2>
        <div class="metric"></div>
    </div>
    <div id="uniqueInstallsThatHaveBeenStarted">
        <h2>Installations</h2>
        <div class="explanation">Unique installations that have actually been started at least once.</div>
        <div class="metric"></div>
    </div>
    <div id="usersHaveStartedGames">
        <h2>Beat the tutorial</h2>
        <div class="explanation">Percentage of unique users who have both launch the app and also managed to figure out how to play.</div>
        <div class="metric"></div>
    </div>
    <div id="deathsPerObstacle"></div>
    <div id="avgScore">
        <h2>Average Score</h2>
        <div class="explanation">(without zero's)</div>
        <div class="metric"></div>
    </div>
    <div id="highestScore">
        <h2>Highest Score</h2>
        <div class="metric"></div>
    </div>
    <div id="scoreScatterplot"></div>
</body>

<script>
    var baseUrl = "https://square-squared-stats.herokuapp.com/";
    $.ajax(baseUrl + 'launch', {
        dataType: "json",
        method: "GET",
        success: function(response) {
            $('#launches .metric').text(response.total);
        }
    });

    $.ajax(baseUrl + 'gameStart', {
        dataType: "json",
        method: "GET",
        success: function(response) {
            $('#gamesStarted .metric').text(response.total);
        }
    });

    $.ajax(baseUrl + 'launch/distinct', {
        dataType: "json",
        method: "GET",
        success: function(response) {
            $('#uniqueInstallsThatHaveBeenStarted .metric').text(response.total);
        }
    });

    $.ajax(baseUrl + 'launch/distinct', {
        dataType: "json",
        method: "GET",
        success: function(launchResponse) {

            $.ajax(baseUrl + 'gameStart/distinct', {
                dataType: "json",
                method: "GET",
                success: function(gameStartResponse) {
                    var percentage = gameStartResponse.total / launchResponse.total * 100;
                    $('#usersHaveStartedGames .metric').text(percentage + "%");
                }
            });
        }
    });

    $.ajax(baseUrl + 'score', {
        dataType: "json",
        method: "GET",
        success: function(response) {
            var max = 0;
            for (var i = 0; i < response.data.length; i++) {
                max = Math.max(response.data[i].score, max);
            }
            $('#highestScore .metric').text(max);
        }
    });

    $.ajax(baseUrl + 'score', {
        dataType: "json",
        method: "GET",
        success: function(response) {
            var total = 0;
            var count = 0;
            for (var i = 0; i < response.data.length; i++) {
                if (response.data[i].score > 0) {
                    total += response.data[i].score;
                    count++;
                }
            }
            $('#avgScore .metric').text(total / count);
        }
    });
</script>

</html>
